# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Nuxt 4 photography portfolio application using TypeScript, Vue 3, and Cloudflare integration. It showcases photo collections stored in Cloudflare R2 with optimized delivery and static site generation.

**Key Technologies:**
- **Framework**: Nuxt 4 with Vue 3 and TypeScript
- **UI Components**: Nuxt UI v3 and Nuxt UI Pro v3 component libraries
- **Styling**: Tailwind CSS with custom color scheme (primary: sky, neutral: slate)
- **Icons**: Heroicons via @iconify-json/heroicons
- **Cloud Storage**: Cloudflare R2 for image storage with Workers bindings
- **Image Processing**: Nuxt Image with Cloudflare provider
- **Deployment**: Cloudflare Workers with Wrangler v4
- **EXIF Processing**: exifr library for image metadata
- **Scripts**: Nuxt Scripts for optimized third-party integrations

## Development Commands

```bash
# Install dependencies
bun install

# Start development server (http://localhost:3000)
bun run dev

# Build for production
bun run build

# Preview production build
bun run preview

# Generate static site
bun run generate

# Deploy to Cloudflare Workers
bun run deploy

# Deploy preview version
bun run deploy:preview

# Lint code
npx eslint .
```

## Architecture Overview

### Cloud Storage Integration
The application integrates with Cloudflare R2 for image storage using Workers bindings:
- Images are organized in root-level collection folders in R2 bucket
- Server API routes (`/server/api/`) handle R2 communication using native Workers bindings
- Collections are auto-discovered from R2 folder structure via `listR2Collections`
- Images are served through Cloudflare's CDN with custom domain: `https://cdn.fiftymillimeter.com`
- R2 bucket binding configured in `wrangler.jsonc` as `R2_BUCKET`
- Supports both production and preview buckets

### API Architecture
- `collections.get.ts`: Lists all photo collections from R2 bucket prefixes
- `images/[collection].get.ts`: Fetches images for a specific collection
- `images/index.get.ts`: General image API endpoint
- All APIs use native Cloudflare Workers R2 bindings for optimal performance
- Dynamic R2 utilities in `/server/utils/r2-dynamic.ts` handle bucket operations

### Frontend Structure
- **Pages**: Standard Nuxt 4 app directory structure with Vue 3 composition API
  - `index.vue`: Homepage
  - `about.vue` & `contact.vue`: Static pages
  - `galleries/index.vue`: Collection listing page
  - `galleries/[collection].vue`: Dynamic collection gallery pages
- **Components**: Reusable Vue components using Nuxt UI
  - `AppHeader.vue`: Navigation header with dynamic collection menu
  - `CollectionCard.vue`: Collection preview cards
  - `ImageGallery.vue`: Photo gallery display component
- **Layouts**: `default.vue` layout with AppHeader integration
- **SEO**: Built-in meta tag management with portfolio-specific defaults

### Environment Configuration
Environment variables are handled through multiple layers:
- **Runtime config** in `nuxt.config.ts` for server-side secrets
- **Wrangler vars** in `wrangler.jsonc` for Workers deployment
- **Public runtime config** for client-accessible variables
- Default site URL: `https://fiftymillimeter.com`

### Static Generation
- Configured for Cloudflare Workers preset
- SSR enabled with static generation capabilities
- Optimized for Cloudflare Workers deployment

### Image Optimization
- Nuxt Image module configured with Cloudflare provider
- Images served from `CLOUDFLARE_R2_PUBLIC_URL` environment variable
- EXIF data processing capabilities with exifr library

## Package Manager

This project uses Bun as the package manager (evidenced by `bun.lock` file). All development commands should use `bun` rather than npm, yarn, or pnpm.

## Environment Variables

The following environment variables are required for the application to function properly:

### Cloudflare R2 Storage
- `CLOUDFLARE_R2_ACCESS_KEY_ID`: R2 access key ID
- `CLOUDFLARE_R2_SECRET_ACCESS_KEY`: R2 secret access key
- `CLOUDFLARE_R2_BUCKET_NAME`: Name of the R2 bucket containing images
- `CLOUDFLARE_R2_ACCOUNT_ID`: Cloudflare account ID
- `CLOUDFLARE_R2_PUBLIC_URL`: Public URL for R2 bucket (custom domain: `https://cdn.fiftymillimeter.com`)

### Site Configuration
- `NUXT_SITE_URL`: Base URL of the site for SEO and og:image generation

## Wrangler Configuration

The project uses Wrangler v4 for Cloudflare Workers deployment:
- **Config file**: `wrangler.jsonc` (JSON with comments)
- **R2 Bindings**: 
  - Production bucket: `fiftymillimeter`
  - Preview bucket: `fiftymillimeter-dev`
  - Binding name: `R2_BUCKET`
- **Assets**: Served from `.output/public` directory
- **Main entry**: `.output/server/index.mjs` (generated by Nuxt build)

### Deployment Commands
- `bun run deploy`: Deploy to production using `wrangler deploy`
- `bun run deploy:preview`: Deploy preview version using `wrangler versions upload`

## UI Component Libraries

### Nuxt UI v3
Primary component library providing:
- Form components (Input, Select, Checkbox, etc.)
- Navigation components (Button, Link, etc.)
- Layout components (Container, Card, etc.)
- Feedback components (Toast, Modal, etc.)

### Nuxt UI Pro v3
Extended component library with advanced components:
- Additional prose components for rich content
- Enhanced form components
- Advanced layout patterns
- Pro-tier design system components

### Color Scheme
Configured in `app.config.ts`:
- **Primary**: Sky blue (`sky`)
- **Neutral**: Slate gray (`slate`)

## Icon System
Uses Heroicons via `@iconify-json/heroicons`:
- Navigation icons (`i-heroicons-home`, `i-heroicons-user`, etc.)
- Consistent iconography throughout the application
- Optimized icon loading through Nuxt UI