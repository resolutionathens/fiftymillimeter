---
phase: 03-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/AppHeader.vue
  - app/components/BlogPostCard.vue
  - app/pages/blog/[slug].vue
  - server/routes/rss.xml.ts
  - nuxt.config.ts
autonomous: true

must_haves:
  truths:
    - "Blog link appears in site header navigation"
    - "Clicking Blog link navigates to /blog"
    - "Posts with category field show category badge on index"
    - "Posts with category field show category badge on post page"
    - "RSS feed is accessible at /rss.xml"
    - "RSS feed contains all blog posts with correct titles and links"
  artifacts:
    - path: "app/components/AppHeader.vue"
      provides: "Navigation with Blog link"
      contains: "label: \"Blog\""
    - path: "app/components/BlogPostCard.vue"
      provides: "Category badge display"
      contains: "UBadge"
    - path: "app/pages/blog/[slug].vue"
      provides: "Category badge on post page"
      contains: "UBadge"
    - path: "server/routes/rss.xml.ts"
      provides: "RSS feed endpoint"
      exports: ["default"]
  key_links:
    - from: "app/components/AppHeader.vue"
      to: "/blog"
      via: "navigationItems to prop"
      pattern: "to:\\s*[\"']/blog[\"']"
    - from: "server/routes/rss.xml.ts"
      to: "/api/content/blog"
      via: "$fetch internal API call"
      pattern: "\\$fetch.*api/content/blog"
---

<objective>
Integrate the blog with the site's navigation, display categories on posts, and provide an RSS feed.

Purpose: Complete the blog feature by making it discoverable (navigation), organized (categories), and subscribable (RSS).
Output: Blog accessible from header, category badges on posts, valid RSS feed at /rss.xml
</objective>

<execution_context>
@/Users/slip/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slip/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration/03-RESEARCH.md

Key existing files:
@app/components/AppHeader.vue - Navigation component with navigationItems array
@app/components/BlogPostCard.vue - Post card component to add category badge
@app/pages/blog/[slug].vue - Post page to add category badge
@server/api/content/blog.get.ts - Existing API returns posts with category field
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Blog link to navigation</name>
  <files>app/components/AppHeader.vue</files>
  <action>
Add Blog entry to the navigationItems computed array in AppHeader.vue.

Insert the Blog entry between Home and Shop (position 2):

```typescript
{
  label: "Blog",
  to: "/blog",
  active: route.path.startsWith("/blog"),
},
```

The navigationItems array will become: Home, Blog, Shop, Galleries, About.

This single array is used for both desktop and mobile navigation, so the change applies to both.
  </action>
  <verify>
Run `bun run dev` and check:
1. Blog link appears in desktop navigation between Home and Shop
2. Blog link appears in mobile navigation (hamburger menu)
3. Clicking Blog navigates to /blog
4. Blog link shows active state when on /blog or /blog/[slug]
  </verify>
  <done>Blog link visible in header navigation and routes to /blog correctly</done>
</task>

<task type="auto">
  <name>Task 2: Display category badges on blog posts</name>
  <files>app/components/BlogPostCard.vue, app/pages/blog/[slug].vue</files>
  <action>
Add category badge display to BlogPostCard.vue and the individual post page.

**BlogPostCard.vue changes:**

1. Add `category?: string` to the BlogPost interface
2. Add UBadge before the title (inside the first div after NuxtLink):

```vue
<!-- Category badge -->
<UBadge
  v-if="post.category"
  :label="post.category"
  color="primary"
  variant="soft"
  size="sm"
  class="mb-2"
/>
```

**app/pages/blog/[slug].vue changes:**

Add UBadge after the breadcrumb nav, before the h1 title:

```vue
<!-- Category badge -->
<UBadge
  v-if="post?.category"
  :label="post.category"
  color="primary"
  variant="soft"
  size="md"
  class="mb-4"
/>
```

Use `v-if` to handle posts without categories gracefully (no empty badge, no errors).
  </action>
  <verify>
1. Create or verify sample post has category in frontmatter (e.g., `category: "Travel"`)
2. Visit /blog - posts with categories show badge above title
3. Visit /blog/[slug] - post page shows category badge before title
4. Posts without category show no badge (no empty space or error)
  </verify>
  <done>Category badges display on blog index cards and individual post pages</done>
</task>

<task type="auto">
  <name>Task 3: Create RSS feed endpoint</name>
  <files>server/routes/rss.xml.ts, nuxt.config.ts</files>
  <action>
Create RSS feed using the `feed` npm package.

**Step 1: Install feed package**
```bash
bun add feed
```

**Step 2: Create server/routes/rss.xml.ts**

```typescript
import { Feed } from 'feed'

export default defineEventHandler(async (event) => {
  const config = useRuntimeConfig()
  const baseUrl = config.public.siteUrl

  const feed = new Feed({
    title: 'Fiftymillimeter Blog',
    description: 'Photography stories and experiences from Ian Kennedy',
    id: `${baseUrl}/blog`,
    link: `${baseUrl}/blog`,
    language: 'en',
    favicon: `${baseUrl}/favicon.ico`,
    copyright: `All rights reserved ${new Date().getFullYear()}, Ian Kennedy`,
    feedLinks: {
      rss2: `${baseUrl}/rss.xml`,
    },
    author: {
      name: 'Ian Kennedy',
      link: baseUrl
    }
  })

  // Fetch posts from existing API
  const posts = await $fetch<any[]>('/api/content/blog')

  for (const post of posts) {
    feed.addItem({
      title: post.title,
      id: `${baseUrl}${post.path}`,
      link: `${baseUrl}${post.path}`,
      description: post.description,
      date: new Date(post.date),
      category: post.category ? [{ name: post.category }] : undefined
    })
  }

  event.node.res.setHeader('content-type', 'application/rss+xml')
  return feed.rss2()
})
```

**Step 3: Add RSS auto-discovery link to nuxt.config.ts**

In the `app.head.link` array, add:

```typescript
{ rel: 'alternate', type: 'application/rss+xml', title: 'Fiftymillimeter Blog RSS Feed', href: '/rss.xml' }
```

**Step 4: Add pre-rendering for RSS route (optional but recommended)**

In nuxt.config.ts, add within nitro config:

```typescript
nitro: {
  preset: 'cloudflare-module',
  cloudflare: {
    deployConfig: true,
    nodeCompat: true
  },
  prerender: {
    routes: ['/rss.xml']
  }
}
```
  </action>
  <verify>
1. `bun run dev` starts without errors
2. Visit http://localhost:3000/rss.xml - returns valid XML
3. RSS contains channel title "Fiftymillimeter Blog"
4. RSS contains items for each blog post
5. Each item has title, link (absolute URL), description, date
6. Items with categories have category element
7. Content-Type header is application/rss+xml
8. View page source on /blog - RSS auto-discovery link present in head
  </verify>
  <done>RSS feed at /rss.xml returns valid RSS 2.0 with all blog posts</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Navigation integration:**
   - `curl -s http://localhost:3000 | grep -o 'Blog'` returns match
   - Clicking Blog in header navigates to /blog

2. **Category display:**
   - Posts with category frontmatter show UBadge on index and detail pages
   - Posts without category show cleanly (no errors, no empty badges)

3. **RSS feed:**
   - `curl -I http://localhost:3000/rss.xml` returns 200 with content-type: application/rss+xml
   - `curl http://localhost:3000/rss.xml | head -20` shows valid RSS XML structure
   - Feed validates at https://validator.w3.org/feed/ (manual check)

4. **Overall:**
   - `bun run dev` runs without errors
   - All Phase 3 requirements (ORG-01, ORG-02, DIST-01, NAV-01) fulfilled
</verification>

<success_criteria>
- Blog link appears in site header navigation (desktop and mobile)
- Category badges display on posts that have category in frontmatter
- RSS feed accessible at /rss.xml with valid RSS 2.0 structure
- All blog posts appear in RSS feed with correct absolute URLs
- Development server runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration/03-01-SUMMARY.md`
</output>
