---
phase: 03-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/AppHeader.vue
  - app/components/BlogPostCard.vue
  - app/pages/blog/[slug].vue
  - server/routes/rss.xml.ts
  - nuxt.config.ts
  - content/blog/first-post.md
autonomous: true

must_haves:
  truths:
    - "Blog link appears in site header navigation"
    - "Clicking Blog link navigates to /blog"
    - "Posts with category field show category badge on index"
    - "Posts with category field show category badge on post page"
    - "RSS feed is accessible at /rss.xml"
    - "RSS feed contains all blog posts with correct titles and links"
  artifacts:
    - path: "app/components/AppHeader.vue"
      provides: "Navigation with Blog link"
      contains: "label: \"Blog\""
    - path: "app/components/BlogPostCard.vue"
      provides: "Category badge display"
      contains: "UBadge"
    - path: "app/pages/blog/[slug].vue"
      provides: "Category badge on post page"
      contains: "UBadge"
    - path: "server/routes/rss.xml.ts"
      provides: "RSS feed endpoint"
      exports: ["default"]
    - path: "content/blog/first-post.md"
      provides: "Sample post with category"
      contains: "category:"
  key_links:
    - from: "app/components/AppHeader.vue"
      to: "/blog"
      via: "navigationItems to prop"
      pattern: "to:\\s*[\"']/blog[\"']"
    - from: "server/routes/rss.xml.ts"
      to: "/api/content/blog"
      via: "$fetch internal API call"
      pattern: "\\$fetch.*api/content/blog"
---

<objective>
Integrate the blog with the site's navigation, display categories on posts, and provide an RSS feed.

Purpose: Complete the blog feature by making it discoverable (navigation), organized (categories), and subscribable (RSS).
Output: Blog accessible from header, category badges on posts, valid RSS feed at /rss.xml
</objective>

<execution_context>
@/Users/slip/.claude/get-shit-done/workflows/execute-plan.md
@/Users/slip/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration/03-RESEARCH.md

Key existing files:
@app/components/AppHeader.vue - Navigation component with navigationItems array
@app/components/BlogPostCard.vue - Post card component to add category badge
@app/pages/blog/[slug].vue - Post page to add category badge
@server/api/content/blog.get.ts - API uses `...data` spread so category is returned if present in frontmatter
@content/blog/first-post.md - Sample post (currently missing category field)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Blog link to navigation</name>
  <files>app/components/AppHeader.vue</files>
  <action>
Add Blog entry to the navigationItems computed array in AppHeader.vue.

Insert the Blog entry between Home and Shop (position 2):

```typescript
{
  label: "Blog",
  to: "/blog",
  active: route.path.startsWith("/blog"),
},
```

The navigationItems array will become: Home, Blog, Shop, Galleries, About.

This single array is used for both desktop and mobile navigation, so the change applies to both.
  </action>
  <verify>
Run `bun run dev` and check:
1. Blog link appears in desktop navigation between Home and Shop
2. Blog link appears in mobile navigation (hamburger menu)
3. Clicking Blog navigates to /blog
4. Blog link shows active state when on /blog or /blog/[slug]
  </verify>
  <done>Blog link visible in header navigation and routes to /blog correctly</done>
</task>

<task type="auto">
  <name>Task 2: Add category to sample post and display category badges</name>
  <files>content/blog/first-post.md, app/components/BlogPostCard.vue, app/pages/blog/[slug].vue</files>
  <action>
**Step 1: Add category to sample post**

Edit `content/blog/first-post.md` frontmatter to add a category field:

```yaml
---
title: "Welcome to the Blog"
date: "2026-01-29"
description: "Introducing a new space to share stories, techniques, and reflections on photography and the creative process."
category: "Updates"
---
```

This enables testing category display. The existing API (`server/api/content/blog.get.ts`) uses `...data` spread, so the category field is automatically included in API responses.

**Step 2: Add category badge to BlogPostCard.vue**

1. Add `category?: string` to the BlogPost interface
2. Add UBadge before the title (inside the first div after NuxtLink):

```vue
<!-- Category badge -->
<UBadge
  v-if="post.category"
  :label="post.category"
  color="primary"
  variant="soft"
  size="sm"
  class="mb-2"
/>
```

**Step 3: Add category badge to app/pages/blog/[slug].vue**

Add UBadge after the breadcrumb nav, before the h1 title:

```vue
<!-- Category badge -->
<UBadge
  v-if="post?.category"
  :label="post.category"
  color="primary"
  variant="soft"
  size="md"
  class="mb-4"
/>
```

Use `v-if` to handle posts without categories gracefully (no empty badge, no errors).
  </action>
  <verify>
1. Check sample post has category: `grep "category:" content/blog/first-post.md`
2. Verify API returns category: `curl -s http://localhost:3000/api/content/blog | grep -o '"category"'`
3. Visit /blog - first-post shows "Updates" badge above title
4. Visit /blog/first-post - post page shows "Updates" badge before title
5. Create a test post without category and verify no badge appears (no empty space or error)
  </verify>
  <done>Sample post has category, and category badges display on blog index cards and individual post pages</done>
</task>

<task type="auto">
  <name>Task 3: Create RSS feed endpoint</name>
  <files>server/routes/rss.xml.ts, nuxt.config.ts</files>
  <action>
Create RSS feed using the `feed` npm package.

**Step 1: Install feed package**
```bash
bun add feed
```

Verify installation:
```bash
grep '"feed"' package.json
```

Should show feed in dependencies.

**Step 2: Create server/routes/rss.xml.ts**

Note: The `server/routes/` directory does not exist yet. Nuxt will auto-create it when you add a file there, or you can create it explicitly:
```bash
mkdir -p server/routes
```

Create `server/routes/rss.xml.ts`:

```typescript
import { Feed } from 'feed'

export default defineEventHandler(async (event) => {
  const config = useRuntimeConfig()
  const baseUrl = config.public.siteUrl

  const feed = new Feed({
    title: 'Fiftymillimeter Blog',
    description: 'Photography stories and experiences from Ian Kennedy',
    id: `${baseUrl}/blog`,
    link: `${baseUrl}/blog`,
    language: 'en',
    favicon: `${baseUrl}/favicon.ico`,
    copyright: `All rights reserved ${new Date().getFullYear()}, Ian Kennedy`,
    feedLinks: {
      rss2: `${baseUrl}/rss.xml`,
    },
    author: {
      name: 'Ian Kennedy',
      link: baseUrl
    }
  })

  // Fetch posts from existing API
  const posts = await $fetch<any[]>('/api/content/blog')

  for (const post of posts) {
    feed.addItem({
      title: post.title,
      id: `${baseUrl}${post.path}`,
      link: `${baseUrl}${post.path}`,
      description: post.description,
      date: new Date(post.date),
      category: post.category ? [{ name: post.category }] : undefined
    })
  }

  event.node.res.setHeader('content-type', 'application/rss+xml')
  return feed.rss2()
})
```

**Step 3: Add RSS auto-discovery link to nuxt.config.ts**

In the `app.head.link` array, add:

```typescript
{ rel: 'alternate', type: 'application/rss+xml', title: 'Fiftymillimeter Blog RSS Feed', href: '/rss.xml' }
```

**Step 4: Add pre-rendering for RSS route (optional but recommended)**

In nuxt.config.ts, add within nitro config:

```typescript
nitro: {
  preset: 'cloudflare-module',
  cloudflare: {
    deployConfig: true,
    nodeCompat: true
  },
  prerender: {
    routes: ['/rss.xml']
  }
}
```
  </action>
  <verify>
1. Verify feed package installed: `grep '"feed"' package.json` returns match
2. Verify routes directory exists: `ls server/routes/rss.xml.ts`
3. `bun run dev` starts without errors
4. Visit http://localhost:3000/rss.xml - returns valid XML
5. RSS contains channel title "Fiftymillimeter Blog"
6. RSS contains items for each blog post
7. Each item has title, link (absolute URL), description, date
8. Items with categories have category element (check for "Updates")
9. Content-Type header is application/rss+xml: `curl -I http://localhost:3000/rss.xml | grep -i content-type`
10. View page source on /blog - RSS auto-discovery link present in head
  </verify>
  <done>RSS feed at /rss.xml returns valid RSS 2.0 with all blog posts</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Navigation integration:**
   - `curl -s http://localhost:3000 | grep -o 'Blog'` returns match
   - Clicking Blog in header navigates to /blog

2. **Category schema verified:**
   - `grep "category:" content/blog/first-post.md` returns match
   - `curl -s http://localhost:3000/api/content/blog | grep -o '"category"'` returns match

3. **Category display:**
   - Posts with category frontmatter show UBadge on index and detail pages
   - Posts without category show cleanly (no errors, no empty badges)

4. **RSS feed:**
   - `curl -I http://localhost:3000/rss.xml` returns 200 with content-type: application/rss+xml
   - `curl http://localhost:3000/rss.xml | head -20` shows valid RSS XML structure
   - Feed validates at https://validator.w3.org/feed/ (manual check)

5. **Overall:**
   - `bun run dev` runs without errors
   - All Phase 3 requirements (ORG-01, ORG-02, DIST-01, NAV-01) fulfilled
</verification>

<success_criteria>
- Blog link appears in site header navigation (desktop and mobile)
- Sample post has category field in frontmatter
- Category badges display on posts that have category in frontmatter
- RSS feed accessible at /rss.xml with valid RSS 2.0 structure
- All blog posts appear in RSS feed with correct absolute URLs
- Development server runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration/03-01-SUMMARY.md`
</output>
